(()=>{var e={257:(e,n,t)=>{const r=t(896),o=JSON.parse(r.readFileSync("./cred.json","utf8"));e.exports=o},788:(e,n,t)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,a(r.key),r)}}function a(e){var n=function(e,n){if("object"!=r(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,n||"default");if("object"!=r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==r(n)?n:String(n)}function i(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */i=function(){return n};var e,n={},t=Object.prototype,o=t.hasOwnProperty,a=Object.defineProperty||function(e,n,t){e[n]=t.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function d(e,n,t){return Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}),e[n]}try{d({},"")}catch(e){d=function(e,n,t){return e[n]=t}}function p(e,n,t,r){var o=n&&n.prototype instanceof E?n:E,i=Object.create(o.prototype),s=new R(r||[]);return a(i,"_invoke",{value:T(e,t,s)}),i}function f(e,n,t){try{return{type:"normal",arg:e.call(n,t)}}catch(e){return{type:"throw",arg:e}}}n.wrap=p;var m="suspendedStart",h="suspendedYield",y="executing",v="completed",g={};function E(){}function b(){}function D(){}var w={};d(w,c,(function(){return this}));var I=Object.getPrototypeOf,N=I&&I(I(M([])));N&&N!==t&&o.call(N,c)&&(w=N);var O=D.prototype=E.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(n){d(e,n,(function(e){return this._invoke(n,e)}))}))}function L(e,n){function t(a,i,s,c){var u=f(e[a],e,i);if("throw"!==u.type){var l=u.arg,d=l.value;return d&&"object"==r(d)&&o.call(d,"__await")?n.resolve(d.__await).then((function(e){t("next",e,s,c)}),(function(e){t("throw",e,s,c)})):n.resolve(d).then((function(e){l.value=e,s(l)}),(function(e){return t("throw",e,s,c)}))}c(u.arg)}var i;a(this,"_invoke",{value:function(e,r){function o(){return new n((function(n,o){t(e,r,n,o)}))}return i=i?i.then(o,o):o()}})}function T(n,t,r){var o=m;return function(a,i){if(o===y)throw new Error("Generator is already running");if(o===v){if("throw"===a)throw i;return{value:e,done:!0}}for(r.method=a,r.arg=i;;){var s=r.delegate;if(s){var c=k(s,r);if(c){if(c===g)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===m)throw o=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=y;var u=f(n,t,r);if("normal"===u.type){if(o=r.done?v:h,u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=v,r.method="throw",r.arg=u.arg)}}}function k(n,t){var r=t.method,o=n.iterator[r];if(o===e)return t.delegate=null,"throw"===r&&n.iterator.return&&(t.method="return",t.arg=e,k(n,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var a=f(o,n.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,g;var i=a.arg;return i?i.done?(t[n.resultName]=i.value,t.next=n.nextLoc,"return"!==t.method&&(t.method="next",t.arg=e),t.delegate=null,g):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,g)}function x(e){var n={tryLoc:e[0]};1 in e&&(n.catchLoc=e[1]),2 in e&&(n.finallyLoc=e[2],n.afterLoc=e[3]),this.tryEntries.push(n)}function C(e){var n=e.completion||{};n.type="normal",delete n.arg,e.completion=n}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function M(n){if(n||""===n){var t=n[c];if(t)return t.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length)){var a=-1,i=function t(){for(;++a<n.length;)if(o.call(n,a))return t.value=n[a],t.done=!1,t;return t.value=e,t.done=!0,t};return i.next=i}}throw new TypeError(r(n)+" is not iterable")}return b.prototype=D,a(O,"constructor",{value:D,configurable:!0}),a(D,"constructor",{value:b,configurable:!0}),b.displayName=d(D,l,"GeneratorFunction"),n.isGeneratorFunction=function(e){var n="function"==typeof e&&e.constructor;return!!n&&(n===b||"GeneratorFunction"===(n.displayName||n.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,D):(e.__proto__=D,d(e,l,"GeneratorFunction")),e.prototype=Object.create(O),e},n.awrap=function(e){return{__await:e}},S(L.prototype),d(L.prototype,u,(function(){return this})),n.AsyncIterator=L,n.async=function(e,t,r,o,a){void 0===a&&(a=Promise);var i=new L(p(e,t,r,o),a);return n.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),d(O,l,"Generator"),d(O,c,(function(){return this})),d(O,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var n=Object(e),t=[];for(var r in n)t.push(r);return t.reverse(),function e(){for(;t.length;){var r=t.pop();if(r in n)return e.value=r,e.done=!1,e}return e.done=!0,e}},n.values=M,R.prototype={constructor:R,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!n)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var t=this;function r(r,o){return s.type="throw",s.arg=n,t.next=r,o&&(t.method="next",t.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=o.call(i,"catchLoc"),u=o.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,n){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=n&&n<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=n,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(i)},complete:function(e,n){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&n&&(this.next=n),g},finish:function(e){for(var n=this.tryEntries.length-1;n>=0;--n){var t=this.tryEntries[n];if(t.finallyLoc===e)return this.complete(t.completion,t.afterLoc),C(t),g}},catch:function(e){for(var n=this.tryEntries.length-1;n>=0;--n){var t=this.tryEntries[n];if(t.tryLoc===e){var r=t.completion;if("throw"===r.type){var o=r.arg;C(t)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(n,t,r){return this.delegate={iterator:M(n),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=e),g}},n}function s(e,n,t,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void t(e)}s.done?n(c):Promise.resolve(c).then(r,o)}function c(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var a=e.apply(n,t);function i(e){s(a,r,o,i,c,"next",e)}function c(e){s(a,r,o,i,c,"throw",e)}i(void 0)}))}}var u=t(581),l=t(875),d=function(e,n,t){console.log("".concat(n,": ").concat(t)),e.status(n),e.send(t)},p=function(){var e=c(i().mark((function e(n,t,r){var o,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=n.body,a=o.id,r.query('\n    SELECT users.id, users.name, roles.id as roleID, roles.name as roleName, roles.index as roleIndex\n      FROM (\n          SELECT id, name, phone, email, "folk-member" as roleID FROM community\n          UNION\n          SELECT id, name, phone, email, roleID FROM incumbents\n      ) AS users\n    JOIN roles ON users.roleID=roles.id\n    WHERE phone = \''.concat(a,"' or email = '").concat(a,"';")).then((function(e){e?e.length?(t.status(200),t.send(e)):d(t,404,"User not found"):d(t,500,"Unknown error while verifying user. Got undefined or null result")})).catch((function(e){d(t,500,e)}));case 3:case"end":return e.stop()}}),e)})));return function(n,t,r){return e.apply(this,arguments)}}(),f=function(){var e=c(i().mark((function e(n,t){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.body,u.send(r).then((function(e){var n=e.status,r=e.error;t.status(n).send(r)})).catch((function(e){console.log(e),d(t,500,e)}));case 2:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),m=function(){var e=c(i().mark((function e(n,t){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.body,u.verify(r).then((function(e){var n=e.status,r=e.error;t.status(n).send(r)})).catch((function(e){d(t,500,e)}));case 2:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),h=function(){var e=c(i().mark((function e(n,t,r){var o,a,s,c,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=n.body,a=o.filename,s=o.imageDataURL,c=s.split(";base64,").pop(),u=Buffer.from(c,"base64"),l.put(a,u).then((function(){t.send()})).catch((function(e){d(t,500,"Could not set user photo: ".concat(e))}));case 5:case"end":return e.stop()}}),e)})));return function(n,t,r){return e.apply(this,arguments)}}(),y=function(){var e=c(i().mark((function e(n,t,r){var o,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=n.body,a=o.id,r.query("SELECT * FROM community WHERE buddy='".concat(a,"' order by name;")).then((function(e){e?(t.status(200),t.send(e)):d(t,500,"Unknown error while fetching buddy list. Got undefined or null result")})).catch((function(e){d(t,500,e)}));case 3:case"end":return e.stop()}}),e)})));return function(n,t,r){return e.apply(this,arguments)}}(),v=function(){var e=c(i().mark((function e(n,t,r){var o,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=n.body,a=o.id,r.query('SELECT assignees.*, IFNULL(incumbents.roleID, "folk-member") as roleID, IFNULL(roles.name, "FOLK Member") as roleName, IFNULL(roles.index, 9) as roleIndex FROM\n  (SELECT community.id, community.name, community.phone, community.dob, community.courseID, community.buddy as buddyID, incumbents.name as buddyName, incumbents.phone as buddyPhone FROM community\n  LEFT JOIN incumbents on incumbents.id=community.buddy\n  WHERE community.preacher=\''.concat(a,"') as assignees\n  LEFT JOIN incumbents on incumbents.id=assignees.id\n  LEFT JOIN roles on roles.id=incumbents.roleID\n  ORDER BY roleIndex, assignees.name")).then((function(e){e?(t.status(200),t.send(e)):d(t,500,"Unknown error while fetching assignees list. Got undefined or null result")})).catch((function(e){d(t,500,e)}));case 3:case"end":return e.stop()}}),e)})));return function(n,t,r){return e.apply(this,arguments)}}(),g=function(){var e=c(i().mark((function e(n,t,r){var o,a,s,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=n.body,a=o.id,s=o.roleID,c=function(e,n){return"folk-member"===n?"SELECT connect.*, incumbents.name as buddyName, incumbents.phone as buddyPhone FROM\n        (SELECT community.preacher as preacherID, community.buddy as buddyID, incumbents.name as preacherName, incumbents.phone as preacherPhone FROM community\n        LEFT JOIN incumbents ON incumbents.id=community.preacher\n        WHERE community.id='".concat(e,"' and incumbents.roleID='folk-guide') connect\n        LEFT JOIN incumbents ON incumbents.id=connect.buddyID and incumbents.roleID='buddy-coord'"):""},r.query(c(a,s)).then((function(e){e?(t.status(200),t.send(e[0]||[])):d(t,500,"Unknown error while fetching home data. Got undefined or null result")})).catch((function(e){d(t,500,e)}));case 4:case"end":return e.stop()}}),e)})));return function(n,t,r){return e.apply(this,arguments)}}(),E={"/verify-user":p,"/send-otp":f,"/verify-otp":m,"/set-user-photo":h,"/get-buddies":y,"/get-assignees":v,"/get-users":function(){var e=c(i().mark((function e(n,t,r){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.query('\n    SELECT users.id, users.name, users.phone, roles.id as roleID, roles.name as roleName, roles.index as roleIndex\n      FROM (\n          SELECT id, name, phone, email, "folk-member" as roleID FROM community\n          UNION\n          SELECT id, name, phone, email, roleID FROM incumbents\n      ) AS users\n    JOIN roles ON users.roleID=roles.id\n    ORDER BY roleIndex asc, users.name asc;').then((function(e){e?e.length?(t.status(200),t.send(e)):d(t,404,"No users found"):d(t,500,"Unknown error while fetching users. Got undefined or null result")})).catch((function(e){d(t,500,e)}));case 1:case"end":return e.stop()}}),e)})));return function(n,t,r){return e.apply(this,arguments)}}(),"/get-home-data":g,"/get-catchup-data":function(){var e=c(i().mark((function e(n,t,r){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.query('\n    SELECT community.id, community.phone, community.name, CASE WHEN LEAST(community.date, MIN(calendar.startDate)) < DATE_SUB(CURDATE(), INTERVAL 2 MONTH) THEN DATE_SUB(CURDATE(), INTERVAL 2 MONTH) ELSE LEAST(community.date, MIN(calendar.startDate)) END AS date FROM community JOIN participation ON participation.participantID=community.id JOIN calendar ON calendar.id=participation.eventID WHERE community.id IN (SELECT id FROM community WHERE courseID!="FEC" AND courseID!="") GROUP BY community.name;\n\n    SELECT community.id, calendar.id as eventID, community.name, community.phone, calendar.startDate AS date, sessions.name AS sessionName, sessions.code, participation.attendance FROM participation JOIN calendar ON calendar.id=participation.eventID JOIN sessions ON sessions.id=calendar.sessionID JOIN community ON community.id=participation.participantID WHERE participation.participantID IN (SELECT id FROM community WHERE courseID!="FEC" AND courseID!="" ORDER BY name) AND calendar.courseID=\'SOS\' ORDER BY participation.participantID, calendar.startDate;\n    \n    SELECT sessions.code, sessions.name, calendar.startDate AS date, calendar.startTime, calendar.endTime FROM calendar JOIN sessions ON sessions.id=calendar.sessionID WHERE calendar.startDate=(SELECT MIN(calendar.startDate) FROM calendar JOIN sessions ON sessions.id = calendar.sessionID WHERE calendar.startDate>NOW() AND sessions.type="CATCHUP") AND calendar.courseID=\'SOS\' AND sessions.type="CATCHUP" ORDER BY calendar.startTime;\n\n    SELECT calendar.id as eventID, calendar.startDate AS date, sessions.code, sessions.name FROM calendar JOIN sessions ON sessions.id = calendar.sessionID WHERE calendar.startDate > (SELECT MIN(mindate.date) AS date FROM (SELECT LEAST(community.date, MIN(calendar.startDate)) AS date FROM community JOIN participation ON participation.participantID=community.id JOIN calendar ON calendar.id=participation.eventID WHERE community.id IN (SELECT id FROM community WHERE courseID!="FEC" AND courseID!="") GROUP BY community.name) mindate) AND calendar.startDate < NOW() AND calendar.courseID=\'SOS\' ORDER BY calendar.startDate;\n  ').then((function(e){e?e.length?(t.status(200),t.send(e)):d(t,404,"No users found"):d(t,500,"Unknown error while fetching catchup data. Got undefined or null result")})).catch((function(e){d(t,500,e)}));case 1:case"end":return e.stop()}}),e)})));return function(n,t,r){return e.apply(this,arguments)}}()},b=function(){function e(n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.db=n}var n,t,r,a;return n=e,t=[{key:"call",value:(a=c(i().mark((function e(n,t){var r,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.get("endpoint"),o=n.get("user"),console.log("[API] [".concat(o||"NO-USER","] ").concat(r)),r in E?E[r](n,t,this.db):d(t,400,"Endpoint ".concat(r," not found"));case 4:case"end":return e.stop()}}),e,this)}))),function(e,n){return a.apply(this,arguments)})}],t&&o(n.prototype,t),r&&o(n,r),Object.defineProperty(n,"prototype",{writable:!1}),e}();e.exports=b},875:(e,n,t)=>{var r=t(257),o="https://cdn.iskconmysore.org/content?path=folkapp/dp",a=t(938),i={head:function(e){return new Promise((function(n,t){a.head("".concat(o,"/").concat(e)).then((function(){n()})).catch((function(e){return t("Error during CDN HEAD request: ".concat(e.message))}))}))},put:function(e,n){return new Promise((function(t,i){a.put("".concat(o,"/").concat(e),n,{headers:{"Content-Type":"image/jpeg","api-key":r.cdn.apiKey}}).then((function(){t("File updated successfully")})).catch((function(e){return i("Error during CDN PUT request: ".concat(e.message))}))}))},delete:function(e){return new Promise((function(n,t){a.delete("".concat(o,"/").concat(e),{headers:{"api-key":r.cdn.apiKey}}).then((function(){n("File deleted successfully")})).catch((function(e){return t("Error during CDN DELETE request: ".concat(e.message))}))}))}};e.exports=i},992:e=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function t(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,r(o.key),o)}}function r(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:String(t)}var o=function(){function e(n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.db=n}var n,r,o;return n=e,(r=[{key:"query",value:function(e){var n=this;return new Promise((function(t,r){n.db.query(e,(function(e,n){if(e)return r(e);t(n)}))}))}},{key:"close",value:function(){this.db.end()}}])&&t(n.prototype,r),o&&t(n,o),Object.defineProperty(n,"prototype",{writable:!1}),e}();e.exports=o},581:(e,n,t)=>{var r=t(257),o="https://otp.iskconmysore.org/data",a=t(938),i={send:function(e){var n=e.id,t=e.target;return new Promise((function(e,i){a.post(o,{id:n,target:t,title:"OTP from FOLK Mysore App"},{headers:{"Content-Type":"application/json","api-key":r.otp.apiKey,endpoint:"/send"}}).then((function(){e({status:200})})).catch((function(n){e({status:n.response.status,error:n.message})}))}))},verify:function(e){var n=e.otp,t=e.id;return new Promise((function(e,i){a.post(o,{otp:n,id:t},{headers:{"Content-Type":"application/json","api-key":r.otp.apiKey,endpoint:"/verify"}}).then((function(){e({status:200})})).catch((function(n){e({status:n.response.status,error:n.message})}))}))}};e.exports=i},949:(e,n,t)=>{var r=t(938),o=t(257),a=new(t(209))(o.telebot.botToken,{polling:!1}),i=["Community","Courses","Sessions","Calendar","Participation"],s={community:["id","date","name","phone","email","preacher","buddy","courseID","category","source","dob","snooze","comments","yearOfJoining","skills","institution","tShirtSize","native","isStudent","course","company","designation"],participation:["participantID","eventID","caller","phone","response","time","attendance","remarks","name"],calendar:["id","startDate","endDate","startTime","endTime","name","courseID","speaker","venue","cost","type","sessionID","felicitation","hidden","remarks"],incumbents:["id","name","phone","email","roleID"],courses:["id","name","level"],sessions:["courseID","name","message","id","type","code","index","canvaLink","videoLink"]},c=["comments","remarks","skills","remarks","message"],u=[{id:"PVPD",name:"Pavana Prana Dasa",phone:"6364903722",email:"pvpd@iskconmysore.org",roleID:"app-admin"},{id:"PVPD",name:"Pavana Prana Dasa",phone:"6364903722",email:"pvpd@iskconmysore.org",roleID:"folk-guide"},{id:"SKKD",name:"Sanaka Kumara Dasa",phone:"6364903726",email:"skkd@iskconmysore.org",roleID:"folk-guide"},{id:"KSD",name:"Karunya Sagar Dasa",phone:"9880544450",email:"ksd@iskconmysore.org",roleID:"folk-guide"}];Array.prototype.insert=function(e,n){return"INSERT INTO ".concat(e," (").concat(this.map((function(e){return"`".concat(e,"`")})).join(", "),") VALUES (").concat(this.map((function(e){return t=n[e],r=e,"boolean"==typeof t||t||(t=null),-1!=c.indexOf(r)&&t&&(t=Buffer.from(t).toString("base64")),null==t?"NULL":"string"==typeof t?'"'.concat(t.replace(/"/g,"'"),'"'):"boolean"==typeof t?t?1:0:t;var t,r})).join(", "),")")};e.exports=function(e){console.log("[SYNC]","sync started"),r.post("https://sheets.iskconmysore.org",{url:"https://docs.google.com/spreadsheets/d/186h3EpvZSvCD8Mcn7NU9TN70BGz_BZtKlSXGHVH_laU/edit#",sheets:i}).then((function(n){console.log("[SYNC]","received sheet data");var t=n.data;e.query("\n\n      BEGIN;\n\n      ".concat([].concat(i).reverse().map((function(e){return"DELETE FROM ".concat(e.toLowerCase())})).join("; "),";\n\n      DELETE FROM incumbents;\n\n      ").concat(i.map((function(e){return e=e.toLowerCase(),t[e].map((function(n){return s[e].insert(e,n)})).join("; ")})).join("; "),";\n\n      ").concat(t.community.filter((function(e){return"Buddy Coordinator"==e.buddyName})).concat(u).map((function(e){var n=e.id,t=e.name,r=e.phone,o=e.email;return s.incumbents.insert("incumbents",{id:n,name:t,phone:r,email:o,roleID:e.roleID||"buddy-coord"})})).join("; "),";\n      \n      COMMIT;\n    ").trim()).then((function(e){console.log("[SYNC]","sync complete")})).catch((function(e){var n=e&&e.response&&e.response.data?e.response.data:e&&e.response?e.response:e;a.sendMessage(o.telebot.apiChatID,"[SYNC ERROR]\n".concat(n)),console.log("[SYNC] ".concat(n))}))})).catch((function(e){console.log("[SYNC] ".concat(e))}))}},393:(e,n,t)=>{var r=t(716),o=t(938),a=t(257),i=new(t(209))(a.telebot.botToken,{polling:!1});e.exports=function(e){e.query("SELECT name, phone, preacher, dob FROM community WHERE dob LIKE '%".concat(r().format("-MM-DD"),"'")).then((function(e){e.length?(console.log("[WISH]","".concat(e.length," wishes today..")),e.forEach((function(e){var n=e.name,t=e.phone,r=e.preacher,s=n.split(" ")[0],c="SKKD"==r?"Sanaka Kumar Dasa":"Pavana Prana Dasa";o.post("https://wame.iskconmysore.org",{template:"folk_wish",phone:t,values:[s,c]},{headers:{"api-key":a.wame.apiKey}}).then((function(){console.log("[WISH]","Wish sent to ".concat(n," (").concat(t,")")),i.sendMessage(a.telebot.wishChatID,"Below wish is sent to ".concat(n," (").concat(t,")\n\n").concat("Hare Krishna Chi. {{1}} !! ðŸŒŸðŸŽ‰\n\nWishing you a very happy Krishna Conscious birthday!! ðŸŽ‚ May Their Lordships Sri Sri Krishna Balaram shower upon you Their choicest blessings âœ¨\n\nMake this day special by visiting our temple ðŸ›• and having a divine darshan of the Lord. ðŸ™\n\nWith heartfelt wishes,\n{{2}}".replace("{{1}}",s).replace("{{2}}",c)))})).catch((function(e){console.log("[WISH]","Wish error: ".concat(e)),i.sendMessage(a.telebot.wishChatID,"Wish error: ".concat(e))}))}))):(console.log("[WISH]","No birthdays today!"),i.sendMessage(a.telebot.wishChatID,"No birthdays today!"))})).catch((function(e){console.log("[WISH] Wish error: ".concat(e)),i.sendMessage(a.telebot.wishChatID,"Wish error: ".concat(e))}))}},938:e=>{"use strict";e.exports=require("axios")},252:e=>{"use strict";e.exports=require("express")},716:e=>{"use strict";e.exports=require("moment")},874:e=>{"use strict";e.exports=require("mysql")},703:e=>{"use strict";e.exports=require("node-cron")},209:e=>{"use strict";e.exports=require("node-telegram-bot-api")},896:e=>{"use strict";e.exports=require("fs")}},n={};function t(r){var o=n[r];if(void 0!==o)return o.exports;var a=n[r]={exports:{}};return e[r](a,a.exports,t),a.exports}(()=>{var e=t(716),n=console.log;console.log=function(){for(var t=(new Date).toISOString(),r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];n.apply(console,["[".concat(e(t).format("YY-MMM-DD HH:mm"),"]")].concat(o))};var r=t(252),o=t(703),a=r();a.use(r.json({limit:"10mb"}));var i=t(788),s=t(992),c=t(257),u=t(949),l=t(393);c.mysql.connectionLimit=100,c.mysql.multipleStatements=!0;var d=new s(t(874).createPool(c.mysql)),p=new i(d);if(a.get("/api",(function(e,n){n.status(200).send()})),a.post("/api",p.call.bind(p)),a.listen(3005,(function(){console.log("App listening at http://localhost:".concat(3005))})),c.cron.sync){var f=e().add(1,"minute").format("mm");console.log("Sync minute - ".concat(f)),o.schedule("".concat(f," * * * *"),(function(){u(d)}))}c.cron.wish&&o.schedule("0 4 * * *",(function(){l(d)}))})()})();